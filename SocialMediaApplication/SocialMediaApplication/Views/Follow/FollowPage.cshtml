@model SocialMediaApplication.Models.FollowViewModel

@{
    ViewBag.Title = "Follow System";
}

<h1>Welcome, @Model.CurrentUser.UserName!</h1>

<h2>People you may know:</h2>
@if (Model.Users != null && Model.Users.Any())
{
    <ul>
        @foreach (var user in Model.Users)
        {
            <li>
                <img src="@user.FollowerAvatar" alt="@user.FollowerName" width="50" height="50" />
                @user.FollowerName
                <button class="btn btn-primary toggle-follow" data-user-id="@user.FollowerId">
                    Follow
                </button>
            </li>
        }
    </ul>
} else
{
     <p>No suggestions available.</p>
}

<h2>Your Followers:</h2>
@if (Model.CurrentUser?.Followers != null && Model.CurrentUser.Followers.Any())
{
    @await Component.InvokeAsync("FollowerViewComponent", new { userId = Model.CurrentUser.UserId })

    <!-- <ul>
        @foreach (var follower in Model.CurrentUser.Followers)
        {
            <li>
                <img src="@follower.FollowerAvatar" alt="@follower.FollowerName" width="50" height="50" />
                @follower.FollowerName
            </li>
        }
    </ul> -->
}else
{
    <p>You have no followers.</p>
}

<h2>People You Follow:</h2>
@if (Model.CurrentUser?.Following != null && Model.CurrentUser.Following.Any())
{
    @await Component.InvokeAsync("FollowingViewComponent", new { userId = Model.CurrentUser.UserId })

    <!-- <ul>
        @foreach (var following in Model.CurrentUser.Following)
        {
            <li>
                <img src="@following.FollowingAvatar" alt="@following.FollowingName" width="50" height="50" />
                @following.FollowingName
                <button class="btn btn-danger toggle-follow" data-user-id="@following.FollowingId">
                    Unfollow
                </button>
            </li>
        }
    </ul> -->
}else
{
    <p>You are not following anyone.</p>
}

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll(".toggle-follow");
            buttons.forEach(button => {
                button.addEventListener("click", function () {
                    const userId = this.getAttribute("data-user-id");
                    fetch('/Follow/ToggleFollow', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'RequestVerificationToken': '@ViewBag.RequestVerificationToken'
                        },
                        body: JSON.stringify({ targetUserId: userId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload();
                        } else {
                            alert("An error occurred while toggling follow status.");
                        }
                    });
                });
            });
        });
    </script>
}
