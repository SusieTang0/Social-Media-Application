@model SocialMediaApplication.Models.FollowViewModel

@{
    ViewBag.Title = "Follow System";
}

<h1>Welcome, @Model.CurrentUser.UserName!</h1>

<h2>People you may know:</h2>
@if (Model.Users != null && Model.Users.Any())
{
    <ul>
        @foreach (var user in Model.Users)
        {
            <li>
              
                <img src="@user.FollowingAvatar" alt="@user.FollowingName" width="50" height="50" />
               
                @user.FollowingName
                <button class="btn btn-primary toggle-follow" data-user-id="@user.FollowingId">
                    Follow
                </button>
            </li>
        }
    </ul>
} else
{
     <p>No suggestions available.</p>
}

<h2>Your Followers:</h2>
@if (Model.CurrentUser?.Followers != null && Model.CurrentUser.Followers.Any())
{
    @await Component.InvokeAsync("Follower", new { userId = Model.CurrentUser.UserId })
  
}else
{
    <p>You have no followers.</p>
}

<h2>People You Follow:</h2>
@if (Model.CurrentUser?.Following != null && Model.CurrentUser.Following.Any())
{ 
    @await Component.InvokeAsync("Following", new { userId = Model.CurrentUser.UserId })
 
}else
{
    <p>You are not following anyone.</p>
}

@Html.AntiForgeryToken()
@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const buttons = document.querySelectorAll(".toggle-follow");
            buttons.forEach(button => {
                button.addEventListener("click", function () {
                    const userId = this.getAttribute("data-user-id");
                     // Retrieve the anti-forgery token from the hidden input
                    const token = document.querySelector('input[name="__RequestVerificationToken"]').value;

                    fetch('/Follow/ToggleFollow', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            //'RequestVerificationToken': '@ViewBag.RequestVerificationToken'
                            'RequestVerificationToken': token
                        },
                        body: JSON.stringify({ targetUserId: userId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            location.reload();
                        } else {
                            alert("An error occurred while toggling follow status.");
                        }
                    });
                });
            });
        });
    </script>
}



