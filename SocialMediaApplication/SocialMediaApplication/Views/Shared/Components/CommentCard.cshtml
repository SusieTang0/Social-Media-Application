@model SocialMediaApplication.Models.Comment
@{
    var thisUser = ViewBag.User as SocialMediaApplication.Models.User;
    var thisOwner = ViewBag.Owner as SocialMediaApplication.Models.User;
    List<User> users = ViewBag.Users as List<SocialMediaApplication.Models.User> ?? new List<User>();
    var commentIdString = Model.CreatedTime.ToString("yyyyMMddHHmmss");
    var authorId = Model.AuthorId ?? string.Empty;
    HashSet<string> follows = ViewBag.Follows;
    var isFollow = follows != null && follows.Contains(thisUser?.UserId);
}

@if (Model != null)
{
    <div class="card card-body text-center mt-2">
        
        <div class="card-body row">
            <div class="col-lg-12 d-flex justify-content-between align-items-center mb-2" style="height:20px;">
                <div class="d-flex justify-content-between align-items-center col-lg-4">
                    @if (!string.IsNullOrEmpty(authorId))
                    {
                        <a asp-action="Index" asp-controller="OtherPages" asp-route-id="@Model.AuthorId" style="text-decoration:none;">
                            <img class="p-2" src="@Model.AuthorAvatar" alt="Profile Picture" style="width:30px;border-radius:50%;" />
                            @Model.AuthorName
                        </a>
                    }
                </div>

                <div class="card-text text-end text-secondary col-lg-4" style="font-size:small">
                    Created Time: @Model.CreatedTime.ToString("MM/dd/yyyy HH:mm")
                    <br />
                    Updated Time: @Model.UpdatedTime.ToString("MM/dd/yyyy HH:mm")
                </div>

                <div class="card-text text-end col-lg-4 d-flex justify-content-end align-items-center">
                    <div class="bg-white  py-2 d-flex justify-content-center align-items-center">
                        @{
                            var liked = Model.Likes?.Any(l => l.Value.UserId == ViewBag.UserId) ?? false;
                        }
                        <div>
                            @if (liked)
                            {
                                <!-- Unlike button -->
                                <form asp-action="UnlikePost" asp-controller="Like" method="post">
                                    <input type="hidden" name="postId" value="@Model.Id" />
                                    <button type="submit" class="btn btn-outline-light mx-3" style="border:none;">
                                        <img src="~/images/heart-outline.svg" alt="Unlike" style="width:20px;" /> Unlike
                                    </button>
                                </form>
                            }
                            else
                            {
                                <!-- Like button -->
                                <form asp-action="LikePost" asp-controller="Like" method="post">
                                    <input type="hidden" name="postId" value="@Model.Id" />
                                    <button type="submit" class="btn btn-outline-light mx-3" style="border:none;">
                                        <img src="~/images/heart.svg" alt="Like" style="width:20px;" /> Like
                                    </button>
                                </form>
                            }
                        </div>
                       
                    </div>
                </div>
                
               
                
            </div>
            <hr class="mt-2" />
            <div class="col-lg-10">
                <p class="card-text text-start">@Model.Content</p>
            </div>
            <!-- Show likes -->
            <div class="col-lg-2">
                <a class="d-inline-flex focus-ring py-1 px-2 text-decoration-none border rounded-2"
                   data-bs-toggle="collapse" href="#collapseLikeC@Model.Id" role="button" aria-expanded="false"
                   aria-controls="collapseLikeC@Model.Id">
                    Likes @(Model.Likes?.Count ?? 0)
                </a>

            </div>
            <div class="collapse mt-2 card card-body col" id="collapseLikeC@Model.Id">
                @if (Model.Likes != null && Model.Likes.Count > 0)
                {
                    <ul class="list-unstyled">
                        @foreach (var like in Model.Likes.Values)
                        {
                            <li>@like.UserName</li>
                        }
                    </ul>
                }
                else
                {
                    <p>No likes yet.</p>
                }
            </div>
          
            
            
            


          
        </div>

    </div>
}
else
{
    <p>Post is not available.</p>
}
